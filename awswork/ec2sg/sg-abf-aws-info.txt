[ec2-user@cookbook ec2sg]$ for i in `aws ec2 describe-security-groups --output text --query 'SecurityGroups[].[GroupId]' --filter Name=group-name,Values="*sg_*"`
> do
> j=$(aws ec2 describe-security-groups --output text --query 'SecurityGroups[].[GroupName]' --filter Name=group-id,Values="$i")
> echo "-----------------------------------------------------------------------"
> echo "$j====>$i"
> echo "-----------------------------------------------------------------------"
> aws ec2 describe-security-groups --group-id $i --output text --query 'SecurityGroups[].[IpPermissions[].[FromPort,IpProtocol,ToPort,join(`,`,IpRanges[].CidrIp),join(`,`,UserIdGroupPairs[].GroupId)]]'|column -t
> done 
-----------------------------------------------------------------------
sg_alb_abfinance_lcb====>sg-434ba427
-----------------------------------------------------------------------
80    tcp   80    0.0.0.0/0
7001  tcp   7001  0.0.0.0/0
9001  tcp   9001  0.0.0.0/0
443   tcp   443   0.0.0.0/0
-1    icmp  -1    0.0.0.0/0
-----------------------------------------------------------------------
sg_alb_abfinance_top20====>sg-886ea1ec
-----------------------------------------------------------------------
80    tcp  80    0.0.0.0/0
9999  tcp  9999  0.0.0.0/0
443   tcp  443   0.0.0.0/0
-----------------------------------------------------------------------
sg_app_abfinance_95569====>sg-4b4ba42f
-----------------------------------------------------------------------
80     tcp  80     0.0.0.0/0
62626  tcp  62626  10.0.0.0/8
9161   tcp  9161   10.0.0.0/8
22     tcp  22     0.0.0.0/0
21     tcp  21     10.0.0.0/8
7080   tcp  7080   0.0.0.0/0
4505   tcp  4506   10.0.0.0/8
53     udp  53     10.219.0.0/16
53     tcp  53     10.219.0.0/16
10050  tcp  10051  10.0.0.0/8
3306   tcp  3306   10.0.0.0/8
389    tcp  389    10.0.0.0/8
9080   tcp  9080   10.0.0.0/8
-----------------------------------------------------------------------
sg_app_abfinance_fileshare====>sg-4c4ba428
-----------------------------------------------------------------------
22     tcp  22     0.0.0.0/0
7001   tcp  7010   10.0.0.0/8
10050  tcp  10051  10.0.0.0/8
-----------------------------------------------------------------------
sg_app_abfinance_lcb_admin====>sg-4d4ba429
-----------------------------------------------------------------------
22     tcp  22     0.0.0.0/0
7001   tcp  7010   10.0.0.0/8
10050  tcp  10051  10.0.0.0/8
-----------------------------------------------------------------------
sg_app_abfinance_lcb_production====>sg-4f4ba42b
-----------------------------------------------------------------------
7001   tcp   7001   10.0.0.0/8,10.4.16.152/32,10.2.4.60/32,10.10.134.185/32
22     tcp   22     0.0.0.0/0
137    udp   138    10.4.16.23/32,10.2.1.18/32,10.2.11.89/32,10.2.11.90/32
139    tcp   902    10.4.16.23/32,10.2.1.18/32,10.2.11.89/32,10.2.11.90/32
7002   tcp   7009   10.0.0.0/8
10050  tcp   10051  10.0.0.0/8
-1     icmp  -1     10.0.0.0/8
2049   tcp   2049   sg-4f4ba42b
-----------------------------------------------------------------------
sg_app_abfinance_lcb_sales====>sg-484ba42c
-----------------------------------------------------------------------
7001   tcp   7001   10.0.0.0/8  sg-434ba427
22     tcp   22     0.0.0.0/0
10050  tcp   10051  10.0.0.0/8
-1     icmp  -1     0.0.0.0/0
-----------------------------------------------------------------------
sg_app_abfinance_lcb_webview====>sg-494ba42d
-----------------------------------------------------------------------
80     tcp   80     10.0.0.0/8
22     tcp   22     0.0.0.0/0
137    udp   138    10.4.16.23/32
7001   tcp   7010   10.0.0.0/8
139    tcp   902    10.4.16.23/32
10050  tcp   10051  10.0.0.0/8
443    tcp   443    10.0.0.0/8
-1     icmp  -1     10.0.0.0/8
2049   tcp   2049   sg-494ba42d
-----------------------------------------------------------------------
sg_app_abfinance_top20====>sg-4a4ba42e
-----------------------------------------------------------------------
80     tcp   80     10.0.0.0/8
8080   tcp   8080   10.0.0.0/8
5432   tcp   5432   0.0.0.0/0
20879  tcp   20883  10.0.0.0/8
873    udp   873    10.0.0.0/8
873    tcp   873    10.0.0.0/8
-1     icmp  -1     0.0.0.0/0
9999   tcp   9999   10.0.0.0/8
22     tcp   22     0.0.0.0/0
6379   tcp   6379   10.0.0.0/8
7474   tcp   7474   0.0.0.0/0
2181   tcp   2181   10.0.0.0/8
3306   tcp   3306   10.0.0.0/8
3690   tcp   3690   0.0.0.0/0
-----------------------------------------------------------------------
sg_cache_abfinance====>sg-544ba430
-----------------------------------------------------------------------
6379  tcp   6379  10.0.0.0/8  sg-484ba42c,sg-494ba42d,sg-4f4ba42b
-1    icmp  -1    10.0.0.0/8
-----------------------------------------------------------------------
sg_cache_abfinance_95569====>sg-554ba431
-----------------------------------------------------------------------
22    tcp  22    10.0.0.0/8
6379  tcp  6379  10.0.0.0/8
-----------------------------------------------------------------------
sg_db_abfinance====>sg-574ba433
-----------------------------------------------------------------------
5800  tcp   6000  10.0.0.0/8
1521  tcp   1521  10.0.0.0/8  sg-484ba42c,sg-494ba42d,sg-4f4ba42b
22    tcp   22    10.0.0.0/8
-1    icmp  -1    10.0.0.0/8
-----------------------------------------------------------------------
sg_db_abfinance_95569====>sg-524ba436
-----------------------------------------------------------------------
5800   tcp  6000   10.0.0.0/8
1521   tcp  1521   10.0.0.0/8
22     tcp  22     10.0.0.0/8
10050  tcp  10050  10.0.0.0/8
-----------------------------------------------------------------------
sg_db_abfinance_top20====>sg-504ba434
-----------------------------------------------------------------------
26379  tcp   26379  10.0.0.0/8
5432   tcp   5432   10.0.0.0/8
20879  tcp   20883  10.0.0.0/8
22     tcp   22     10.0.0.0/8
6379   tcp   6379   10.0.0.0/8
873    tcp   873    10.0.0.0/8
7474   tcp   7474   10.0.0.0/8
27017  tcp   27017  10.0.0.0/8
2181   tcp   2181   10.0.0.0/8
3306   tcp   3306   10.0.0.0/8
-1     icmp  -1     10.0.0.0/8
-----------------------------------------------------------------------
sg_elb_abfinance_95569====>sg-534ba437
-----------------------------------------------------------------------
80    tcp   80    0.0.0.0/0
5999  tcp   5999  0.0.0.0/0
8009  tcp   8009  0.0.0.0/0
7080  tcp   7080  0.0.0.0/0
-1    icmp  -1    0.0.0.0/0
-----------------------------------------------------------------------
sg_nat_abfinance====>sg-5c4ba438
-----------------------------------------------------------------------
80    tcp   80    0.0.0.0/0
7001  tcp   7001  sg-484ba42c,sg-494ba42d,sg-4f4ba42b
22    tcp   22    0.0.0.0/0
25    tcp   25    sg-4b4ba42f
873   tcp   873   10.0.0.0/8
53    udp   53    sg-4b4ba42f
443   tcp   443   10.219.16.0/20
-1    icmp  -1    0.0.0.0/0
-----------------------------------------------------------------------
sg_waf_abfinance====>sg-635d9907
-----------------------------------------------------------------------
80    tcp   80    0.0.0.0/0
995   tcp   995   sg-635d9907
22    tcp   22    0.0.0.0/0
8443  tcp   8443  0.0.0.0/0
8800  tcp   8800  0.0.0.0/0
443   tcp   443   0.0.0.0/0
-1    icmp  -1    0.0.0.0/0
-----------------------------------------------------------------------
sg_zcl====>sg-c314dea7
-----------------------------------------------------------------------
-----------------------------------------------------------------------
test_sg_app_abfinance====>sg-ccee2fa8
-----------------------------------------------------------------------
80     tcp   80     10.0.0.0/8
8080   tcp   8080   10.0.0.0/8
22     tcp   22     10.0.0.0/8
6379   tcp   6379   10.0.0.0/8
20880  tcp   20880  10.0.0.0/8
873    tcp   873    10.0.0.0/8
20882  tcp   20882  10.0.0.0/8
2181   tcp   2181   10.0.0.0/8
3306   tcp   3306   10.0.0.0/8
443    tcp   443    10.0.0.0/8
-1     icmp  -1     10.0.0.0/8
-----------------------------------------------------------------------
test_sg_db_abfinance====>sg-895796ed
-----------------------------------------------------------------------
22    tcp   22    10.0.0.0/8
6379  tcp   6379  10.0.0.0/8
3306  tcp   3306  10.0.0.0/8
-1    icmp  -1    10.0.0.0/8
-----------------------------------------------------------------------
test_sg_nat_abfinance====>sg-90d21df4
-----------------------------------------------------------------------
80   tcp   80   10.0.0.0/8
22   tcp   22   0.0.0.0/0
443  tcp   443  10.0.0.0/8
-1   icmp  -1   10.0.0.0/8
[ec2-user@cookbook ec2sg]$ for i in `aws ec2 describe-security-groups --output text --query 'SecurityGroups[].[GroupId]' --filter Name=group-name,Values="*sg_*"`; do j=$(aws ec2 describe-security-groups --output text --query 'SecurityGroups[].[GroupName]' --filter Name=group-id,Values="$i"); echo "-----------------------------------------------------------------------"; echo "$j====>$i"; echo "-----------------------------------------------------------------------"; aws ec2 describe-security-groups --group-id $i --output text --query 'SecurityGroups[].[IpPermissions[].[FromPort,IpProtocol,ToPort,join(`,`,IpRanges[].CidrIp),join(`,`,UserIdGroupPairs[].GroupId)]]'|column -t; done
