# Kickstart file automatically generated by anaconda.

install

url --url="http://192.168.1.110/rhel6.5-x86_64/"

lang en_US.UTF-8

zerombr  yes

key --skip

keyboard us

xconfig --startxonboot --defaultdesktop=GNOME

#network --device eth0 --bootproto static --ip 192.168.1.110 --netmask 255.255.255.0 --gateway 192.168.1.1 --nameserver 211.98.2.4 
network  --bootproto=dhcp --device=eth0 --onboot=on

rootpw --iscrypted $1$fbDw936i$/PaWQ.GvTmwdD8D9P5Kft1

#firewall --enabled --port=22:tcp
firewall --disabled

#authconfig --enableshadow --enablemd5
auth  --useshadow  --passalgo=sha512

selinux --disabled

timezone Asia/Shanghai

bootloader --location=mbr --driveorder=sda

text

logging --level=info

reboot

clearpart --all --initlabel 

part /boot --fstype=ext4 --size=200
part pv.008002 --grow --asprimary --size=200

volgroup sysvg --pesize=4096 pv.008002
logvol swap --name=LogVol00 --vgname=sysvg --size=2048
logvol / --fstype=ext4 --name=LogVol01 --vgname=sysvg --size=18228

%packages
@additional-devel
@base
@basic-desktop
@chinese-support
@cifs-file-server
@compat-libraries
@console-internet
@debugging
@desktop-debugging
@desktop-platform
@desktop-platform-devel
@development
@directory-client
@directory-server
@eclipse
@emacs
@fonts
@ftp-server
@general-desktop
@graphical-admin-tools
@graphics
@identity-management-server
@java-platform
@legacy-unix
@legacy-x
@mail-server
@mysql
@mysql-client
@network-server
@network-tools
@nfs-file-server
@performance
@perl-runtime
@postgresql
@postgresql-client
@scientific
@security-tools
@server-platform
@server-platform-devel
@smart-card
@storage-client-multipath
@storage-server
@system-admin-tools
@system-management
@system-management-snmp
@system-management-wbem
@tex
@web-server
@x11
compat-openmpi
compat-openmpi-psm
crypto-utils
hmaccalc
mod_revocator
samba

%end

%post

#ntpdate sync

ntpdate 10.10.2.65
#hwclock --systohc
#echo -e "0 1 * * * root /usr/sbin/ntpdate cn.pool.ntp.org > /dev/null"  >> /etc/crontab
#service crond restart

#group add

groupadd weblogic
mkdir -p /home/weblogic

#user add

useradd -g weblogic  weblogic  -d /home/weblogic -m
echo "webDESK123!@"|passwd weblogic --stdin

#root nologin

#sed -i "s/#PermitRootLogin yes/PermitRootLogin no/g" '/etc/ssh/sshd_config'
#service sshd restart

#reboot off servers

chkconfig acpid off
chkconfig atd off
chkconfig autofs off
chkconfig bluetooth off
chkconfig cpuspeed off
chkconfig firstboot off
chkconfig gpm off
chkconfig haldaemon off
chkconfig hidd off
chkconfig ip6tables off
chkconfig isdn off
chkconfig messagebus off
chkconfig nfslock off
chkconfig pcscd off
chkconfig portmap off
chkconfig rpcgssd off
chkconfig rpcidmapd off
chkconfig yum-updatesd off
chkconfig sendmail off

#reboot on servers

chkconfig crond on
chkconfig network on
chkconfig sshd on
chkconfig syslog on

#non "Ctrl+Alt+Del" to reboot 

#sed -i "s/ca::ctrlaltdel:\/sbin\/shutdown -t3 -r now/#ca::ctrlaltdel:\/sbin\/shutdown -t3 -r now/g" '/etc/inittab'
#telinit q

#system optimized

echo -e "ulimit -c unlimited"  >> /etc/profile
echo -e "ulimit -s unlimited"  >> /etc/profile
echo -e "ulimit -SHn 65535"  >> /etc/profile
source  /etc/profile

sed -i "s/net.ipv4.ip_forward = 0/net.ipv4.ip_forward = 1/g" '/etc/sysctl.conf'
echo -e "net.core.somaxconn = 262144"  >> /etc/sysctl.conf
echo -e "net.core.netdev_max_backlog = 262144"  >> /etc/sysctl.conf
echo -e "net.core.wmem_default = 8388608"  >> /etc/sysctl.conf
echo -e "net.core.rmem_default = 8388608"  >> /etc/sysctl.conf
echo -e "net.core.rmem_max = 16777216"  >> /etc/sysctl.conf
echo -e "net.core.wmem_max = 16777216"  >> /etc/sysctl.conf
echo -e "net.ipv4.netfilter.ip_conntrack_max = 131072"  >> /etc/sysctl.conf
echo -e "net.ipv4.netfilter.ip_conntrack_tcp_timeout_established = 180"  >> /etc/sysctl.conf
echo -e "net.ipv4.route.gc_timeout = 20"  >> /etc/sysctl.conf
echo -e "net.ipv4.ip_conntrack_max = 819200"  >> /etc/sysctl.conf
echo -e "net.ipv4.ip_local_port_range = 10024  65535"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_retries2 = 5"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_fin_timeout = 30"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_syn_retries = 1"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_synack_retries = 1"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_timestamps = 0"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_tw_recycle = 1"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_tw_len = 1"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_tw_reuse = 1"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_keepalive_time = 120"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_keepalive_probes = 3"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_keepalive_intvl = 15"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_max_tw_buckets = 36000"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_max_orphans = 3276800"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_max_syn_backlog = 262144"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_wmem = 8192 131072 16777216"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_rmem = 32768 131072 16777216"  >> /etc/sysctl.conf
echo -e "net.ipv4.tcp_mem = 94500000 915000000 927000000"  >> /etc/sysctl.conf
/sbin/sysctl -p

#exec sh

cd /root

wget http://192.168.21.128/cobbler/ks_mirror/config/autoip.sh

sh /root/autoip.sh

:wq!

vi /var/www/cobbler/ks_mirror/config/autoip.sh

#!/bin/sh

ROUTE=$(route -n|grep "^0.0.0.0"|awk '{print $2}')

BROADCAST=$(/sbin/ifconfig eth0|grep -i bcast|awk '{print $3}'|awk -F":" '{print $2}')

HWADDR=$(/sbin/ifconfig eth0|grep -i HWaddr|awk '{print $5}')

IPADDR=$(/sbin/ifconfig eth0|grep "inet addr"|awk '{print $2}'|awk -F":" '{print $2}')

NETMASK=$(/sbin/ifconfig eth0|grep "inet addr"|awk '{print $4}'|awk -F":" '{print $2}')

cat >/etc/sysconfig/network-scripts/ifcfg-eth0<<EOF

DEVICE=eth0

BOOTPROTO=static

BROADCAST=$BROADCAST

HWADDR=$HWADDR

IPADDR=$IPADDR

NETMASK=$NETMASK

GATEWAY=$ROUTE

ONBOOT=yes

EOF

IPADDR1=$(echo $IPADDR|awk -F"." '{print $4}')

cat >/etc/sysconfig/network-scripts/ifcfg-eth1<<EOF

DEVICE=eth1

BOOTPROTO=static

BROADCAST=10.0.0.255

HWADDR=$(/sbin/ifconfig eth1|grep -i HWaddr|awk '{print $5}')

IPADDR=10.0.0.$IPADDR1

NETMASK=255.255.255.0

ONBOOT=yes

EOF

HOSTNAME=OsYunWei_HZ_$(echo $IPADDR|awk -F"." '{print $4}')

cat >/etc/sysconfig/network<<EOF

NETWORKING=yes

NETWORKING_IPV6=no

HOSTNAME=$HOSTNAME

GATEWAY=$ROUTE

EOF

echo "127.0.0.1  $HOSTNAME" >> /etc/hosts

hostname=$HOSTNAME

echo "nameserver  8.8.8.8"  > /etc/resolv.conf

echo "nameserver  8.8.4.4" >> /etc/resolv.conf
